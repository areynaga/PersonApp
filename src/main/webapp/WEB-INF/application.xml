<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:jaxws="http://cxf.apache.org/jaxws"
	xmlns:camel="http://camel.apache.org/schema/spring" 
	xmlns:cxf="http://camel.apache.org/schema/cxf"
	xmlns:soap="http://cxf.apache.org/bindings/soap" 
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:broker="http://activemq.apache.org/schema/core"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://cxf.apache.org/bindings/soap 
		http://cxf.apache.org/schemas/configuration/soap.xsd
		http://cxf.apache.org/jaxws 
		http://cxf.apache.org/schemas/jaxws.xsd
		http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
       	http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
		http://www.springframework.org/schema/tx
       	http://www.springframework.org/schema/tx/spring-tx.xsd
       	http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/util 
        http://www.springframework.org/schema/util/spring-util-3.0.xsd
        http://activemq.apache.org/schema/core 
        http://activemq.apache.org/schema/core/activemq-core-5.5.0.xsd">

	<import resource="classpath:META-INF/cxf/cxf.xml" />
	<import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
	<import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

	
	
	<bean id="activemq"
		class="org.apache.activemq.camel.component.ActiveMQComponent">
		<property name="brokerURL" value="vm://localhost:61616"/>
	</bean>


	<broker:broker useJmx="false" persistent="false" brokerName="localhost">
		<broker:transportConnectors>
			<broker:transportConnector uri="vm://localhost:61616"/>
		</broker:transportConnectors>
	</broker:broker>
	 
	
 
 
 
 	<bean id="appProperties" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    	<property name="locations" value="classpath:/config.properties"/>
	</bean>

 
 	

	<bean id="personServiceRoute" class="be.steria.datapoc.services.routes.MainServiceRoute" >
		<property name="serverName" value="${server.name}" />
		<property name="inputQueueName" value="${server.inputQueue}" />
		<property name="outputQueueName" value="${server.outputQueue}" />
		
	</bean>
	
	<tx:annotation-driven transaction-manager="myTransactionManager" />

 
	<bean id="myTransactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="entityManagerFactory" />
	</bean>

	<bean id="entityManagerFactory"
		class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean">
		<property name="persistenceUnitName" value="PersonDB" />
	</bean>
	
	<bean id="personDao" class="be.steria.datapoc.dao.PersonDaoImpl" />
	

	<bean id="personProcessor" class="be.steria.datapoc.services.PersonProcessorImpl" >
		<property name="serverName" value="${server.name}"/>
		  
		<property name="personDao" ref="personDao" />
		
	</bean>
	
	
	<bean id="centralNodePredicate" class="be.steria.datapoc.services.CentralNodePredicate" >
		<property name="centralNode" value="${server.central}"/>
	</bean>
	
	<cxf:cxfEndpoint id="personEndpoint" address="/PersonService"
		serviceClass="be.steria.datapoc.services.PersonService" />
		
	
	
	<camelContext xmlns="http://camel.apache.org/schema/spring">
		
		 
		 <camel:routeBuilder ref="personServiceRoute"/>
		
	</camelContext>

	<bean id="nodesInformation" class="be.steria.datapoc.services.LocalNodesInformation" >
		<property name="currentNodeName" value="${server.name}"/>
	</bean>


	<bean id="serviceReplicator" class="be.steria.datapoc.services.ServiceReplicatorImpl" >
		
		<property name="nodesInformation" ref="nodesInformation" />
	</bean>
	

	<context:annotation-config />


</beans>